{% extends "base.html" %}
{% block title %}Data Preview Â· Benford{% endblock %}
{% block content %}
<div class="card">
    <h1>Data Preview</h1>
    <p class="muted" style="margin-bottom:16px;">Review your upload, confirm the column to analyze, and proceed to Benford's Law testing.</p>

    <div class="grid grid-2" style="margin-bottom:12px;">
        <div style="background: var(--surface); padding:12px 14px; border-radius:12px;">
            <div class="muted" style="font-size:12px; text-transform:uppercase;">Total Rows</div>
            <div style="font-size:24px; font-weight:700;">{{ row_count }}</div>
        </div>
        <div style="background: var(--surface); padding:12px 14px; border-radius:12px;">
            <div class="muted" style="font-size:12px; text-transform:uppercase;">Total Columns</div>
            <div style="font-size:24px; font-weight:700;">{{ all_cols|length }}</div>
        </div>
    </div>

    {% if numeric_cols %}
    <div class="section">
        <h3>Available Numeric Columns</h3>
        <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;">
            {% for col in numeric_cols %}
            <span class="pill pill-green">{{ col }}</span>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="section">
        <div class="pill pill-red" style="margin-top:8px;">No numeric columns found</div>
        <p class="muted" style="margin-top:6px;">Benford's analysis requires numeric data. Try another file.</p>
    </div>
    {% endif %}

    <div class="section">
        <h3>All Columns</h3>
        <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;">
            {% for col in all_cols %}
                {% if col in numeric_cols %}
                <span class="pill pill-green">{{ col }}</span>
                {% else %}
                <span class="pill" style="background:#eef2ff; color:#4338ca;">{{ col }}</span>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div class="section">
        <h3>Data Preview (first 10 rows)</h3>
        <div style="overflow-x:auto; margin-top:10px;">
            {{ preview_html|safe }}
        </div>
    </div>

    {% if numeric_cols %}
    <form method="post" action="/analyze" style="margin-top:18px; display:flex; flex-direction:column; gap:12px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="filename" value="{{ filename }}">
        <label style="font-weight:600;">Select column to analyze</label>
        <select name="column" required style="padding:12px; border:2px solid var(--border); border-radius:10px;">
            <option value="">-- Choose a numeric column --</option>
            {% for col in numeric_cols %}
            <option value="{{ col }}">{{ col }}</option>
            {% endfor %}
        </select>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button type="submit" class="btn btn-primary">Run Analysis</button>
            <a href="/" class="btn btn-secondary">Upload different file</a>
        </div>
    </form>
    {% else %}
    <div style="margin-top:16px;">
        <a href="/" class="btn btn-secondary">Upload different file</a>
    </div>
    {% endif %}
</div>
{% endblock %}
